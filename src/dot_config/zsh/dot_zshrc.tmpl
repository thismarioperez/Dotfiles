# create cache directories if they don't exist
if [ ! -d $XDG_CACHE_HOME ]; then
    mkdir -p $XDG_CACHE_HOME
fi

if [ ! -d $XDG_CACHE_HOME/zsh ]; then
    mkdir -p $XDG_CACHE_HOME/zsh
fi

# ZSH configuration
HISTFILE=$XDG_CACHE_HOME/zsh/histfile
HISTSIZE=1000
SAVEHIST=1000
ENABLE_CORRECTION="true"
bindkey -e # use emacs key bindings (default)

# add Homebrew to PATH on apple silicon
[ -f /opt/homebrew/bin/brew ] && eval "$(/opt/homebrew/bin/brew shellenv)"

# safely add android tools to PATH
if [ -v "$HOME/Library/Android/sdk" ]; then
    export ANDROID_HOME=$HOME/Library/Android/sdk
    export PATH=$PATH:$ANDROID_HOME/emulator
    export PATH=$PATH:$ANDROID_HOME/tools
    export PATH=$PATH:$ANDROID_HOME/tools/bin
    export PATH=$PATH:$ANDROID_HOME/platform-tools
fi

# Load and configure zsh completion
autoload -Uz compinit
compinit -d $XDG_CACHE_HOME/zsh/zcompdump
# automatically load bash completion functions
autoload -U +X bashcompinit && bashcompinit

# Safely load oh-my-posh
if command -v oh-my-posh 1>/dev/null 2>&1; then
    eval "$(oh-my-posh init zsh --config $XDG_DATA_HOME/oh-my-posh/themes/thismarioperez.omp.json)"
fi

# Safely load nvm and it's completions
export NVM_DIR="$XDG_CONFIG_HOME/nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"                   # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion" # This loads nvm bash_completion

# fzf
export FZF_DEFAULT_COMMAND="fd . $HOME"
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_ALT_C_COMMAND="fd -t d . $HOME"
export FZF_COMPLETION_TRIGGER='**'

# Aliases
source "$ZDOTDIR/aliases.zsh"

# Load plugins
source "$ZDOTDIR/plugins.zsh"
